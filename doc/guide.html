<!DOCTYPE html >
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Aluesarjat: Simplified Operation & Maintenance Guide</title>
<style type="text/css">
dt {
font-family: "courier";
}
</style>
</head>
<body>
<h1>Aluesarjat: Simplified Operation & Maintenance Guide</h1>


<h2>System requirements</h2>

Versions numbers refer to ones used in development and testing. Newer versions and
any Java compliant platform/JVM should however suffice - at least with some tweaking.
<ul>
    <li>Linux Ubuntu, Mac OS X 10.6</li>
    <li>Java SE 1.6</li>
    <li>Maven 2.2</li>
    <li>OpenLink Virtuoso Universal Server (with RDF/SPARQL support) 6.1</li>
</ul>

<h2>Development</h2>

<h3>Tools</h3>
<ul>
<li>Eclipse</li>
<li>SVN</li>
<li>SVN plugin for Eclipse</li>
<li>Virtuoso <i>is not</i> needed for basic development and testing, which is done using
Sesame Native RDF repository. It requires no additional configuration and stores it's data
in <tt>${java.io.tmpdir}/aluesarjat/data</tt>. Improper shutdown of webapp may corrupt this database.
However all data can always be securely reloaded by deleting the database and restarting the app.</li>
</ul>

<h3>Project structure</h3>
<dl>
<dt>src/test/java</dt>
<dd>Unit Tests (JUnit) and helpper applications (e.g. webapp starter and various to-RDF-conversion applications)</dd>

<dt>src/test/resources</dt>
<dd>Files needed by tests and original export files</dd>

<dt>src/main/java</dt>
<dd>Java classes of the main application: PCAxis parser, PCAxis-to-RDF converter and Webapp</dd>

<dt>src/main/resources</dt>
<dd>Webapp configuration and default data files</dd>

<dt>doc</dt>
<dd>Documents</dd>

<dt>profiles</dt>
<dd>Deployment profiles</dd>

<dt>target</dt>
<dd>Internal build work directory. Not to be modified by hand.</dd>
</dl>

<h3>Getting Started</h3>
<ol>
<li>Import aluesarjat into Eclipse as general purpose project.
</li>
<li>
Open console and go to project directory.
</li>
<li>Prepare and verify development setup by runing 
<pre>
mvn clean eclipse:eclipse -DdownloadSources=true install
</pre>
</li>
<li>
Refresh and clean project in Eclipse.
</li>
</ol>

<h3>Testing and Running Webapp on localhost</h3>
<ul>
<li>Tests can be run individually in Eclipse using JUnit test runner</li>
<li>All tests are run as part of Maven build life cycle (e.g. <tt>mvn test</tt> or <tt>mvn install</tt>)</li>
<li>Webapp can be run using either 
<dl>
<dt>AluesarjatStart</dt><dd>With build-in Sesame native RDF repository</dd>
<dt>AluesarjatVirtuosoStart</dt><dd>With high scalability Virtuoso RDF repository. 
Virtuoso's connection properties are read from the classpath resource <tt>aluesarjat.properties: virtuoso.host,
virtuoso.port,
virtuoso.user, </tt>and 
<tt>virtuoso.pass.</tt> 
</dd>
</dl>
</li>
</ul>


<h2>PCAxis parser</h2>

PCAxisParser is a streaming parser for PX files. It converts PX files into a minimal statistical class 
model (see below) that consists of Dataset, DimensionType, Dimension and Item. 
First it collects all relevant 
metadata into a Dataset instance which is given to the handler. Then it streams all DATA items 
as Item instances to the handler. The handler has also methods for begin, rollback and commit, for 
proper allocation and releasing of required resources (e.g. DB connection or transaction).

<img src="parser.png" alt="PCAxis parser"/>

<p>RDFDatasetHandler converts Datasets and Items
into Scovo based RDF that is further streamed into database in optimized batches. 
ANTLR based parser was first tested, but it proved
unscalable for larger PX files - even heap size of 2GB was not enough to hold the intermediate AST tree. 
</p>
<h2>URI Schema</h2>

With RDF one URI schema is needed for resource identifiers. Another URI schema is needed for Web Application.
In this Linked Open Data pilot we combinet these as much as possible following REST principles. 
Thus where ever practical RDF data is accessbile using real URI's.
All URIs share common base URI which is the URI of the application it self.
BaseURI is configured in <tt>aluesarjat.properties: baseURI</tt>.

<h3>Data (RDF Resource) URIs</h3>

These URIs by which given type of data is exposed as RDF are also used internally as contexts for
corresponding RDF statements. 

<p>While the RDF data model consists of subject-predicate-object 
triples, in many practical applications one handles quadruples instead under hood with source (or context or model)
as a fourth member. This context may be any URI but usually it is the main namespace of the triples without 
namespace/local name delimiter (e.g. trailing # or /).</p>

<dl>
<dt>${baseURI}/rdf/dimensions</dt>
<dd>Common dimension metamodel: All scovo:Dimension (sub) classes - i.e. dimension types. 
Namespace / local name delimiter for dimension types is "/". E.g. dimensions/Alue</dd>

<dt>${baseURI}/rdf/dimensions/${dimension}</dt>
<dd>Values of given dimension. Namespace / local name delimiter for dimension values is "#". E.g. dimension/Alue#_091_Helsinki</dd>

<dt>${baseURI}/rdf/datasets</dt>
<dd>Dataset metadata. Namespace / local name delimiter for dataset URIs' is "#". E.g. datasets#A01HKI_Astuot_hper_rahoitus_talotyyppi. 
Data items of individual datasets are internally mapped to a context denoted by dataset URI. 
As this dataset URI is partly composed of fragment ID, items are not directly accessible as RDF.
This limitation is by design, because the size of RDF serialization of items of even 
a single dataset may be several Giga Bytes.</dd>

<dt>item:${sha1 of item predicates} - INTERNAL</dt>
<dd>As publishing individual items directly in either dataset wide RDF bundles nor individuals
is not practical, Blank Node would be a natural choice for item identifiers. 
Unfortunately there are severe limitations to querying and modifying RDF data with BNodes: BNodes cannot 
be accessed using standard SPARQL and typically cannot be referenced from outside a database transaction.
What's more, BNode behaviour differs from RDF database implementation to another.
<p>As a practical approach we chose a proprietary URI scheme for data item ID's. This ID consists
of "item:" prefix and a SHA-1 checksum of item's statements. This way we may for example reload
data without duplicates - as long as the algorithm or data it self havent changed.
These items are also accessible using SPARQL, without which building the webapp would have been 
conciderably more difficult. 
</dd>
</dl>

<h3>Webapp URIs and Servlets</h3>

Webapp consists of Servlets that are mapped to URLs using Guice Servlet extension. Guice is 
also used for wiring application dependencies (dependency injection).
</body>

<h2>Web pages</h2>

<h3>Faceted search</h3>

<p>TODO</p>

<h3>SPARQL query form</h3>

<p>The SPARQL query form provides an easy to use interface to execute SPARQL queries against the integrated HTTP based SPARQL endpoint.
The queries are entered into the query field and either executed via the Submit Query -button or saved into the list of saved queries via the
Save Query -button. Default namespaces for most of the query cases are by default used and needn't be declared in the Query field.</p>

<p>The page size of results can be controlled via the Page size field. For cases where the result size exceeds the page size, the Previous and Next page
links can be used for navigation between the result pages.</p>

<p>Saved queries can be copied into the Query form by single clicks and deleted from the list of saved queries by double clicks.</p>

<h3>Map visualization</h3>

<p>The Map visualization uses a GoogleMaps widget to show the area borders of the Capital Region of Helsinki. The visualization
uses three layers of widgets to show large areas for small zoom levels, medium areas for medium zoom range and small areas for high zoom range.
</p>

<p>When crossing an area with the mouse, the background opacity of the area becomes smaller and a marker with the area title is shown at the center
point of the area. When clicking an area related data is shown in the info widget on the right of the window. The tabs of the info widget contain
a general description of the area, the DBpedia description of the area and a small excerpt of the area statistics. </p>

<p></p>


</html>